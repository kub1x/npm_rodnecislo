'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RodneCislo = RodneCislo;
exports.rodnecislo = rodnecislo;
// rodnecislo.js
// version : 0.0.1
// authors : Jakub Podlaha
// license : MIT
// github.com/kub1x/rodnecislo

var GENDER = {
  MALE: 'MALE',
  FEMALE: 'FEMALE'
};

var MONTH_OFFSET = 1;
var DEFAULT_ADULTHOOD = 18;

function RodneCislo(value) {
  var _this = this;

  // PIN parts
  var _yy = void 0,
      _mm = void 0,
      _dd = void 0,
      _xxx = void 0,

  // Parsed birthdate
  _D = void 0,
      _M = void 0,
      _YYYY = void 0;
  // Gender
  var _gender = 'MALE';
  // PIN attributes
  var _longFormat = false;
  // Validation
  var _error = null;

  this.year = function () {
    return _YYYY;
  };
  this.month = function () {
    return _M;
  };
  this.day = function () {
    return _D;
  };

  this.birthDate = function () {
    return new Date(_YYYY, _M, _D);
  };
  this.birthDateAsString = function () {
    return _D + '.' + (_M + MONTH_OFFSET) + '.' + _YYYY;
  };

  this.dic = function () {
    return 'CZ' + _yy + _mm + _dd + _xxx;
  };

  this.gender = function () {
    return _gender;
  };
  this.isMale = function () {
    return _gender === GENDER.MALE;
  };
  this.isFemale = function () {
    return _gender === GENDER.FEMALE;
  };

  this.isValid = function () {
    return !_error;
  };
  this.error = function () {
    return _error;
  };

  this.isAdult = function () {
    var adulthood = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_ADULTHOOD;
    return _this.age() >= adulthood;
  };

  this.age = function () {
    // Current date parsed (ignoring +1 timezone)
    var now = new Date();
    var CYYYY = now.getFullYear();
    var CM = now.getMonth();
    var CD = now.getDate();

    var age = CYYYY - _YYYY;

    if (CM > _M) {
      return age;
    }
    if (CM < _M) {
      return --age;
    }

    // We're on the MONTH of the bday.

    // NOTE In Czech you reach certain age at the beginning of your birthday.
    return CD >= _D ? age : --age;
  };

  /**
   * with OR without slash '/' between date part and distinction part
   * with 3 OR 4 digits of distinction part
   */
  var RODNECISLO_RE = /(\d\d)(\d\d)(\d\d)\/?(\d\d\d\d?)/;
  var MATCH_YY = 1;
  var MATCH_MM = 2;
  var MATCH_DD = 3;
  var MATCH_XX = 4;

  var LONG_XX_LENGTH = 4;

  var BEGIN = 0;
  var LAST = -1;

  var MODULO = 11;
  var MODULO_RESULT = 0;
  var MODULO_EXCEPTION_VALUE = 10;
  var MODULO_EXCEPTION_CHECK = 0;

  function parseRawInput(inputText) {
    var match = RODNECISLO_RE.exec(inputText);

    if (!match) {
      _error = 'Didn\'t match RegEx';
      return false;
    }

    _longFormat = match[MATCH_XX].length === LONG_XX_LENGTH;

    var whole = void 0,
        test = void 0,
        check = void 0;

    try {
      // Birth date parsed
      _yy = match[MATCH_YY];
      _mm = match[MATCH_MM];
      _dd = match[MATCH_DD];
      _xxx = match[MATCH_XX];

      if (_longFormat) {
        whole = '' + match[MATCH_YY] + match[MATCH_MM] + match[MATCH_DD] + match[MATCH_XX];
        test = +whole.slice(BEGIN, LAST); // all but last
        check = +whole.slice(LAST); // the last digit
        whole = +whole; // all of it
      }
    } catch (e) {
      _error = 'Failed to parse input string';
      return false;
    }

    if (_longFormat) {
      if (whole % MODULO === MODULO_RESULT) {
        // good old classic
      } else if (test % MODULO === MODULO_EXCEPTION_VALUE && check === MODULO_EXCEPTION_CHECK) {
        // the rare 1000 cases
      } else {
        _error = 'Failed the modulo condition';
        return false;
      }
    }
    return true;
  }

  var YEAR53 = 53;
  var CENT19 = 1900;
  var CENT20 = 2000;

  var WOMAN_MM_ADDITION = 50;
  var EXTRA_MM_ADDITION = 20;

  function isDateValid(y, m, d) {
    var date = new Date(y, m, d);
    var convertedDate = '' + date.getFullYear() + date.getMonth() + date.getDate();
    var givenDate = '' + y + m + d;

    return givenDate === convertedDate;
  }

  function parseBirthDate() {
    // Year
    _YYYY = +_yy;
    if (!_longFormat && _YYYY <= YEAR53) {
      // since ever - 31.12.1953
      _YYYY += CENT19;
    } else if (_longFormat && _YYYY > YEAR53) {
      // 1.1.1954 - 31.12.1999
      _YYYY += CENT19;
    } else if (_longFormat && _YYYY <= YEAR53) {
      // 1.1.2000 - 31.12.2053
      _YYYY += CENT20;
    } else {
      // NOTE This never happends as it would be the same as for 1954-2000
      // 1.1.2054 - until ever
      _error = 'We didn\'t think about this yet...';
      return false;
    }

    // Month and Gender
    _M = +_mm;

    // Women have month + 50
    if (_M > WOMAN_MM_ADDITION) {
      _gender = GENDER.FEMALE;
      _M %= WOMAN_MM_ADDITION;
    }

    // Sometimes men/women get extra month + 20
    _M %= EXTRA_MM_ADDITION;

    // Ok
    _M -= MONTH_OFFSET;
    _D = +_dd;

    // Final birthdate validation
    if (!isDateValid(_YYYY, _M, _D)) {
      _error = 'Invalid birth date';
      return false;
    }

    return true;
  }

  parseRawInput(value);
  parseBirthDate();

  return this;
} // RodneCislo

function rodnecislo(value) {
  return new RodneCislo(value);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9saWIvcm9kbmVjaXNsby5qcyJdLCJuYW1lcyI6WyJSb2RuZUNpc2xvIiwicm9kbmVjaXNsbyIsIkdFTkRFUiIsIk1BTEUiLCJGRU1BTEUiLCJNT05USF9PRkZTRVQiLCJERUZBVUxUX0FEVUxUSE9PRCIsInZhbHVlIiwiX3l5IiwiX21tIiwiX2RkIiwiX3h4eCIsIl9EIiwiX00iLCJfWVlZWSIsIl9nZW5kZXIiLCJfbG9uZ0Zvcm1hdCIsIl9lcnJvciIsInllYXIiLCJtb250aCIsImRheSIsImJpcnRoRGF0ZSIsIkRhdGUiLCJiaXJ0aERhdGVBc1N0cmluZyIsImRpYyIsImdlbmRlciIsImlzTWFsZSIsImlzRmVtYWxlIiwiaXNWYWxpZCIsImVycm9yIiwiaXNBZHVsdCIsImFkdWx0aG9vZCIsImFnZSIsIm5vdyIsIkNZWVlZIiwiZ2V0RnVsbFllYXIiLCJDTSIsImdldE1vbnRoIiwiQ0QiLCJnZXREYXRlIiwiUk9ETkVDSVNMT19SRSIsIk1BVENIX1lZIiwiTUFUQ0hfTU0iLCJNQVRDSF9ERCIsIk1BVENIX1hYIiwiTE9OR19YWF9MRU5HVEgiLCJCRUdJTiIsIkxBU1QiLCJNT0RVTE8iLCJNT0RVTE9fUkVTVUxUIiwiTU9EVUxPX0VYQ0VQVElPTl9WQUxVRSIsIk1PRFVMT19FWENFUFRJT05fQ0hFQ0siLCJwYXJzZVJhd0lucHV0IiwiaW5wdXRUZXh0IiwibWF0Y2giLCJleGVjIiwibGVuZ3RoIiwid2hvbGUiLCJ0ZXN0IiwiY2hlY2siLCJzbGljZSIsImUiLCJZRUFSNTMiLCJDRU5UMTkiLCJDRU5UMjAiLCJXT01BTl9NTV9BRERJVElPTiIsIkVYVFJBX01NX0FERElUSU9OIiwiaXNEYXRlVmFsaWQiLCJ5IiwibSIsImQiLCJkYXRlIiwiY29udmVydGVkRGF0ZSIsImdpdmVuRGF0ZSIsInBhcnNlQmlydGhEYXRlIl0sIm1hcHBpbmdzIjoiOzs7OztRQWNnQkEsVSxHQUFBQSxVO1FBb0xBQyxVLEdBQUFBLFU7QUFsTWhCO0FBQ0E7QUFDQTtB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LE1BQWpCO0FBQ0FTLFlBQU1vRCxpQkFBTjtBQUNEOztBQUVEO0FBQ0FwRCxVQUFNcUQsaUJBQU47O0FBRUE7QUFDQXJELFVBQU1SLFlBQU47QUFDQU8sU0FBSyxDQUFDRixHQUFOOztBQUVBO0FBQ0EsUUFBSSxDQUFDeUQsWUFBWXJELEtBQVosRUFBbUJELEVBQW5CLEVBQXVCRCxFQUF2QixDQUFMLEVBQWlDO0FBQy9CSyxlQUFTLG9CQUFUO0FBQ0EsYUFBTyxLQUFQO0FBQ0Q7O0FBRUQsV0FBTyxJQUFQO0FBQ0Q7O0FBRURtQyxnQkFBYzdDLEtBQWQ7QUFDQW1FOztBQUVBLFNBQU8sSUFBUDtBQUVELEMsQ0FBQzs7QUFFSyxTQUFTekUsVUFBVCxDQUFvQk0sS0FBcEIsRUFBMkI7QUFDaEMsU0FBTyxJQUFJUCxVQUFKLENBQWVPLEtBQWYsQ0FBUDtBQUNEIiwiZmlsZSI6InJvZG5lY2lzbG8uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyByb2RuZWNpc2xvLmpzXG4vLyB2ZXJzaW9uIDogMC4wLjFcbi8vIGF1dGhvcnMgOiBKYWt1YiBQb2RsYWhhXG4vLyBsaWNlbnNlIDogTUlUXG4vLyBnaXRodWIuY29tL2t1YjF4L3JvZG5lY2lzbG9cblxuY29uc3QgR0VOREVSID0ge1xuICBNQUxFOiAnTUFMRScsXG4gIEZFTUFMRTogJ0ZFTUFMRSdcbn07XG5cbmNvbnN0IE1PTlRIX09GRlNFVCA9IDE7XG5jb25zdCBERUZBVUxUX0FEVUxUSE9PRCA9IDE4O1xuXG5leHBvcnQgZnVuY3Rpb24gUm9kbmVDaXNsbyh2YWx1ZSkge1xuXG4gIC8vIFBJTiBwYXJ0c1xuICBsZXQgX3l5LCBfbW0sIF9kZCwgX3h4eCxcbiAgLy8gUGFyc2VkIGJpcnRoZGF0ZVxuICAgIF9ELCBfTSwgX1lZWVk7XG4gIC8vIEdlbmRlclxuICBsZXQgX2dlbmRlciA9ICdNQUxFJztcbiAgLy8gUElOIGF0dHJpYnV0ZXNcbiAgbGV0IF9sb25nRm9ybWF0ID0gZmFsc2U7XG4gIC8vIFZhbGlkYXRpb25cbiAgbGV0IF9lcnJvciA9IG51bGw7XG5cbiAgdGhpcy55ZWFyID0gKCkgPT4gX1lZWVk7XG4gIHRoaXMubW9udGggPSAoKSA9PiBfTTtcbiAgdGhpcy5kYXkgPSAoKSA9PiBfRDtcblxuICB0aGlzLmJpcnRoRGF0ZSA9ICgpID0+IG5ldyBEYXRlKF9ZWVlZLCBfTSwgX0QpO1xuICB0aGlzLmJpcnRoRGF0ZUFzU3RyaW5nID0gKCkgPT4gYCR7X0R9LiR7X00gKyBNT05USF9PRkZTRVR9LiR7X1lZWVl9YDtcblxuICB0aGlzLmRpYyA9ICgpID0+IGBDWiR7X3l5fSR7X21tfSR7X2RkfSR7X3h4eH1gO1xuXG4gIHRoaXMuZ2VuZGVyID0gKCkgPT4gX2dlbmRlcjtcbiAgdGhpcy5pc01hbGUgPSAoKSA9PiBfZ2VuZGVyID09PSBHRU5ERVIuTUFMRTtcbiAgdGhpcy5pc0ZlbWFsZSA9ICgpID0+IF9nZW5kZXIgPT09IEdFTkRFUi5GRU1BTEU7XG5cbiAgdGhpcy5pc1ZhbGlkID0gKCkgPT4gIV9lcnJvcjtcbiAgdGhpcy5lcnJvciA9ICgpID0+IF9lcnJvcjtcblxuICB0aGlzLmlzQWR1bHQgPSAoYWR1bHRob29kID0gREVGQVVMVF9BRFVMVEhPT0QpID0+IHRoaXMuYWdlKCkgPj0gYWR1bHRob29kO1xuXG4gIHRoaXMuYWdlID0gKCkgPT4ge1xuICAgIC8vIEN1cnJlbnQgZGF0ZSBwYXJzZWQgKGlnbm9yaW5nICsxIHRpbWV6b25lKVxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgQ1lZWVkgPSBub3cuZ2V0RnVsbFllYXIoKTtcbiAgICBjb25zdCBDTSA9IG5vdy5nZXRNb250aCgpO1xuICAgIGNvbnN0IENEID0gbm93LmdldERhdGUoKTtcblxuICAgIGxldCBhZ2UgPSBDWVlZWSAtIF9ZWVlZO1xuXG4gICAgaWYgKENNID4gX00pIHsgcmV0dXJuIGFnZTsgfVxuICAgIGlmIChDTSA8IF9NKSB7IHJldHVybiAtLWFnZTsgfVxuXG4gICAgLy8gV2UncmUgb24gdGhlIE1PTlRIIG9mIHRoZSBiZGF5LlxuXG4gICAgLy8gTk9URSBJbiBDemVjaCB5b3UgcmVhY2ggY2VydGFpbiBhZ2UgYXQgdGhlIGJlZ2lubmluZyBvZiB5b3VyIGJpcnRoZGF5LlxuICAgIHJldHVybiAoQ0QgPj0gX0QpID8gYWdlIDogLS1hZ2U7XG4gIH07XG5cblxuICAvKipcbiAgICogd2l0aCBPUiB3aXRob3V0IHNsYXNoICcvJyBiZXR3ZWVuIGRhdGUgcGFydCBhbmQgZGlzdGluY3Rpb24gcGFydFxuICAgKiB3aXRoIDMgT1IgNCBkaWdpdHMgb2YgZGlzdGluY3Rpb24gcGFydFxuICAgKi9cbiAgY29uc3QgUk9ETkVDSVNMT19SRSA9IC8oXFxkXFxkKShcXGRcXGQpKFxcZFxcZClcXC8/KFxcZFxcZFxcZFxcZD8pLztcbiAgY29uc3QgTUFUQ0hfWVkgPSAxO1xuICBjb25zdCBNQVRDSF9NTSA9IDI7XG4gIGNvbnN0IE1BVENIX0REID0gMztcbiAgY29uc3QgTUFUQ0hfWFggPSA0O1xuXG4gIGNvbnN0IExPTkdfWFhfTEVOR1RIID0gNDtcblxuICBjb25zdCBCRUdJTiA9IDA7XG4gIGNvbnN0IExBU1QgPSAtMTtcblxuICBjb25zdCBNT0RVTE8gPSAxMTtcbiAgY29uc3QgTU9EVUxPX1JFU1VMVCA9IDA7XG4gIGNvbnN0IE1PRFVMT19FWENFUFRJT05fVkFMVUUgPSAxMDtcbiAgY29uc3QgTU9EVUxPX0VYQ0VQVElPTl9DSEVDSyA9IDA7XG5cbiAgZnVuY3Rpb24gcGFyc2VSYXdJbnB1dChpbnB1dFRleHQpIHtcbiAgICBjb25zdCBtYXRjaCA9IFJPRE5FQ0lTTE9fUkUuZXhlYyhpbnB1dFRleHQpO1xuXG4gICAgaWYgKCFtYXRjaCkge1xuICAgICAgX2Vycm9yID0gJ0RpZG5cXCd0IG1hdGNoIFJlZ0V4JztcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBfbG9uZ0Zvcm1hdCA9IG1hdGNoW01BVENIX1hYXS5sZW5ndGggPT09IExPTkdfWFhfTEVOR1RIO1xuXG4gICAgbGV0IHdob2xlLCB0ZXN0LCBjaGVjaztcblxuICAgIHRyeSB7XG4gICAgICAvLyBCaXJ0aCBkYXRlIHBhcnNlZFxuICAgICAgX3l5ID0gbWF0Y2hbTUFUQ0hfWVldO1xuICAgICAgX21tID0gbWF0Y2hbTUFUQ0hfTU1dO1xuICAgICAgX2RkID0gbWF0Y2hbTUFUQ0hfRERdO1xuICAgICAgX3h4eCA9IG1hdGNoW01BVENIX1hYXTtcblxuICAgICAgaWYgKF9sb25nRm9ybWF0KSB7XG4gICAgICAgIHdob2xlID0gYCR7bWF0Y2hbTUFUQ0hfWVldfSR7bWF0Y2hbTUFUQ0hfTU1dfSR7bWF0Y2hbTUFUQ0hfRERdfSR7bWF0Y2hbTUFUQ0hfWFhdfWA7XG4gICAgICAgIHRlc3QgPSArd2hvbGUuc2xpY2UoQkVHSU4sIExBU1QpOyAvLyBhbGwgYnV0IGxhc3RcbiAgICAgICAgY2hlY2sgPSArd2hvbGUuc2xpY2UoTEFTVCk7IC8vIHRoZSBsYXN0IGRpZ2l0XG4gICAgICAgIHdob2xlID0gK3dob2xlOyAvLyBhbGwgb2YgaXRcbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIF9lcnJvciA9ICdGYWlsZWQgdG8gcGFyc2UgaW5wdXQgc3RyaW5nJztcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoX2xvbmdGb3JtYXQpIHtcbiAgICAgIGlmICh3aG9sZSAlIE1PRFVMTyA9PT0gTU9EVUxPX1JFU1VMVCkge1xuICAgICAgICAvLyBnb29kIG9sZCBjbGFzc2ljXG4gICAgICB9IGVsc2UgaWYgKHRlc3QgJSBNT0RVTE8gPT09IE1PRFVMT19FWENFUFRJT05fVkFMVUUgJiYgY2hlY2sgPT09IE1PRFVMT19FWENFUFRJT05fQ0hFQ0spIHtcbiAgICAgICAgLy8gdGhlIHJhcmUgMTAwMCBjYXNlc1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2Vycm9yID0gJ0ZhaWxlZCB0aGUgbW9kdWxvIGNvbmRpdGlvbic7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBjb25zdCBZRUFSNTMgPSA1MztcbiAgY29uc3QgQ0VOVDE5ID0gMTkwMDtcbiAgY29uc3QgQ0VOVDIwID0gMjAwMDtcblxuICBjb25zdCBXT01BTl9NTV9BRERJVElPTiA9IDUwO1xuICBjb25zdCBFWFRSQV9NTV9BRERJVElPTiA9IDIwO1xuXG4gIGZ1bmN0aW9uIGlzRGF0ZVZhbGlkKHksIG0sIGQpIHtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoeSwgbSwgZCk7XG4gICAgY29uc3QgY29udmVydGVkRGF0ZSA9IGAke2RhdGUuZ2V0RnVsbFllYXIoKX0ke2RhdGUuZ2V0TW9udGgoKX0ke2RhdGUuZ2V0RGF0ZSgpfWA7XG4gICAgY29uc3QgZ2l2ZW5EYXRlID0gYCR7eX0ke219JHtkfWA7XG5cbiAgICByZXR1cm4gKGdpdmVuRGF0ZSA9PT0gY29udmVydGVkRGF0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUJpcnRoRGF0ZSgpIHtcbiAgICAvLyBZZWFyXG4gICAgX1lZWVkgPSArX3l5O1xuICAgIGlmICghX2xvbmdGb3JtYXQgJiYgX1lZWVkgPD0gWUVBUjUzKSB7XG4gICAgICAvLyBzaW5jZSBldmVyIC0gMzEuMTIuMTk1M1xuICAgICAgX1lZWVkgKz0gQ0VOVDE5O1xuICAgIH0gZWxzZSBpZiAoX2xvbmdGb3JtYXQgJiYgX1lZWVkgPiBZRUFSNTMpIHtcbiAgICAgIC8vIDEuMS4xOTU0IC0gMzEuMTIuMTk5OVxuICAgICAgX1lZWVkgKz0gQ0VOVDE5O1xuICAgIH0gZWxzZSBpZiAoX2xvbmdGb3JtYXQgJiYgX1lZWVkgPD0gWUVBUjUzKSB7XG4gICAgICAvLyAxLjEuMjAwMCAtIDMxLjEyLjIwNTNcbiAgICAgIF9ZWVlZICs9IENFTlQyMDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTk9URSBUaGlzIG5ldmVyIGhhcHBlbmRzIGFzIGl0IHdvdWxkIGJlIHRoZSBzYW1lIGFzIGZvciAxOTU0LTIwMDBcbiAgICAgIC8vIDEuMS4yMDU0IC0gdW50aWwgZXZlclxuICAgICAgX2Vycm9yID0gJ1dlIGRpZG5cXCd0IHRoaW5rIGFib3V0IHRoaXMgeWV0Li4uJztcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBNb250aCBhbmQgR2VuZGVyXG4gICAgX00gPSArX21tO1xuXG4gICAgLy8gV29tZW4gaGF2ZSBtb250aCArIDUwXG4gICAgaWYgKF9NID4gV09NQU5fTU1fQURESVRJT04pIHtcbiAgICAgIF9nZW5kZXIgPSBHRU5ERVIuRkVNQUxFO1xuICAgICAgX00gJT0gV09NQU5fTU1fQURESVRJT047XG4gICAgfVxuXG4gICAgLy8gU29tZXRpbWVzIG1lbi93b21lbiBnZXQgZXh0cmEgbW9udGggKyAyMFxuICAgIF9NICU9IEVYVFJBX01NX0FERElUSU9OO1xuXG4gICAgLy8gT2tcbiAgICBfTSAtPSBNT05USF9PRkZTRVQ7XG4gICAgX0QgPSArX2RkO1xuXG4gICAgLy8gRmluYWwgYmlydGhkYXRlIHZhbGlkYXRpb25cbiAgICBpZiAoIWlzRGF0ZVZhbGlkKF9ZWVlZLCBfTSwgX0QpKSB7XG4gICAgICBfZXJyb3IgPSAnSW52YWxpZCBiaXJ0aCBkYXRlJztcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHBhcnNlUmF3SW5wdXQodmFsdWUpO1xuICBwYXJzZUJpcnRoRGF0ZSgpO1xuXG4gIHJldHVybiB0aGlzO1xuXG59IC8vIFJvZG5lQ2lzbG9cblxuZXhwb3J0IGZ1bmN0aW9uIHJvZG5lY2lzbG8odmFsdWUpIHtcbiAgcmV0dXJuIG5ldyBSb2RuZUNpc2xvKHZhbHVlKTtcbn1cbiJdfQ==